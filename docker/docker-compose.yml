version: '3.5'
name: 'flucks'

networks:
  flucks.net:
    driver: bridge

services:
  app:
    build:
      context: .
      target: dev
    command: yarn dev
    env_file: .env.local
    volumes:
      - ../application:/app
      - ../application/node_modules:/app/node_modules
      - ../application/.next:/app/.next
    ports:
      - '35300:3000'

  adminer:
    image: adminer
    ports:
      - '35301:8080'
    networks:
      - flucks.net

  flucks.db:
    image: 'postgres:latest'
    env_file: ./db.env
    ports:
      - '35302:5432'
    networks:
      - flucks.net

  webrtc:
    image: 'node:alpine'
    ports:
      - '35303:3000'
    env_file:
      - express.env
    command: sh -c "npm i && npm run start"
    volumes:
      - ../server:/usr/src/app
    working_dir: /usr/src/app
    networks:
      - flucks.net
    environment:
      - NODE_ENV=development

  api:
    image: 'node:alpine'
    ports:
      - '35305:3000'
    command: sh -c "npm i && npm run dev"
    volumes:
      - ../api:/app
    working_dir: /app
    networks:
      - flucks.net
    environment:
      - NODE_ENV=development
